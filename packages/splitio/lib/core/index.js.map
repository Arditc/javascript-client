{"version":3,"sources":["../../es6/core/index.js"],"names":[],"mappings":"WAAY;;;;;;;;AAEZ,IAAI,mBAAmB,QAAQ,4CAAR,CAAnB;AACJ,IAAI,WAAW,QAAQ,2CAAR,CAAX;;eAKA,QAAQ,8BAAR;;IAFF;IACA;;;AAGF,IAAI,UAAU,QAAQ,gCAAR,CAAV;;AAEJ,IAAI,aAAa,KAAb;AACJ,IAAI,OAAO;AACT,0BAAQ;AACN,QAAI,CAAC,UAAD,EAAa;AACf,mBAAa,IAAb,CADe;KAAjB,MAEO;AACL,aAAO,kBAAQ,MAAR,CAAe,wBAAf,CAAP,CADK;KAFP;;AAMA,QAAI,eAAe,SAAS,GAAT,CAAa,MAAb,CAAf,CAPE;AAQN,QAAI,sBAAsB,SAAS,GAAT,CAAa,qBAAb,CAAtB,CARE;AASN,QAAI,sBAAsB,SAAS,GAAT,CAAa,qBAAb,CAAtB,CATE;;AAWN,QAAI,wBAAwB,kBAAxB,CAXE;AAYN,QAAI,2BAA2B,kBAA3B;;;;;AAZE,WAiBC,sBAAsB,OAAtB,CAA8B,mBAA9B,EAAmD,mBAAnD,EAAwE,YAAxE,EAAsF,IAAtF,CAA2F,YAAM;AACtG,aAAO,yBAAyB,OAAzB,CAAiC,eAAjC,EAAkD,mBAAlD,EAAuE,YAAvE,CAAP,CADsG;KAAN,CAAlG,CAjBM;GADC;AAuBT,gCAAW;AACT,WAAO,UAAP,CADS;GAvBF;CAAP;;AA4BJ,OAAO,OAAP,GAAiB,IAAjB","file":"index.js","sourcesContent":["/* @flow */ 'use strict';\n\nlet SchedulerFactory = require('@splitsoftware/splitio-utils/lib/scheduler');\nlet settings = require('@splitsoftware/splitio-utils/lib/settings');\n\nlet {\n  splitChangesUpdater,\n  segmentsUpdater\n} = require('@splitsoftware/splitio-cache');\n\nlet metrics = require('@splitsoftware/splitio-metrics');\n\nlet _isStarted = false;\nlet core = {\n  start() {\n    if (!_isStarted) {\n      _isStarted = true;\n    } else {\n      return Promise.reject('Engine already started');\n    }\n\n    let coreSettings = settings.get('core');\n    let featuresRefreshRate = settings.get('featuresRefreshRate');\n    let segmentsRefreshRate = settings.get('segmentsRefreshRate');\n\n    let splitRefreshScheduler = SchedulerFactory();\n    let segmentsRefreshScheduler = SchedulerFactory();\n\n    // the first time the download is sequential:\n    // 1- download feature settings\n    // 2- segments\n    return splitRefreshScheduler.forever(splitChangesUpdater, featuresRefreshRate, coreSettings).then(() => {\n      return segmentsRefreshScheduler.forever(segmentsUpdater, segmentsRefreshRate, coreSettings);\n    });\n  },\n\n  isStared() {\n    return _isStarted;\n  }\n};\n\nmodule.exports = core;\n"]}