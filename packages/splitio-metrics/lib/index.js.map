{"version":3,"sources":["../es6/index.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,SAAS,QAAQ,WAAR,CAAT;AACJ,IAAI,UAAU,QAAQ,YAAR,CAAV;AACJ,IAAI,iBAAiB,QAAQ,WAAR,CAAjB;AACJ,IAAI,qBAAqB,QAAQ,uBAAR,CAArB;AACJ,IAAI,gBAAgB,QAAQ,qCAAR,CAAhB;;AAEJ,SAAS,aAAT,CAAuB,IAAvB,EAA6B,gBAA7B,EAA+C;AAC7C,MAAI,IAAI,kBAAJ,CADyC;AAE7C,MAAI,IAAI,eAAe,CAAf,CAAJ,CAFyC;;AAI7C,SAAO;AACL,gCAAU;AACR,aAAO,CAAP,CADQ;KADL;AAKL,gCAAU;AACR,aAAO,CAAC,EAAE,OAAF,EAAD,IAAgB,OAAO;AAC5B,0BAAkB,cAAc,GAAd,CAAkB,kBAAlB,CAAlB;AACA,aAAK,QAAQ,kBAAR,EAA4B,CAA5B,CAAL;OAFqB,EAItB,IAJsB,CAIjB,UAAS,IAAT,EAAe;AAAE,UAAE,KAAF,GAAF,OAAoB,IAAP,CAAb;OAAf,CAJiB,CAKtB,KALsB,CAKhB,UAAS,KAAT,EAAgB;AAAE,UAAE,KAAF,GAAF;OAAhB,CALA,CADC;KALL;GAAP,CAJ6C;CAA/C;;AAoBA,IAAI,MAAM,cAAc,kBAAd,EAAkC,kBAAlC,CAAN;;AAEJ,SAAS,OAAT,GAAmB;AACjB,MAAI,OAAJ,GADiB;CAAnB;;AAIA,OAAO,OAAP,GAAiB;AACf,UADe;AAEf,kBAFe;CAAjB","file":"index.js","sourcesContent":["'use strict';\n\nlet timeDS = require('./ds/time');\nlet timeDTO = require('./dto/time');\nlet trackerFactory = require('./tracker');\nlet fibonacciCollector = require('./collector/fibonacci');\nlet splitSettings = require('@splitsoftware/splitio/lib/settings');\n\nfunction metricFactory(name, collectorFactory) {\n  let c = collectorFactory();\n  let t = trackerFactory(c);\n\n  return {\n    tracker() {\n      return t;\n    },\n\n    publish() {\n      return !c.isEmpty() && timeDS({\n        authorizationKey: splitSettings.get('authorizationKey'),\n        dto: timeDTO('sdk.getTreatment', c)\n      })\n      .then(function(resp) { c.clear(); return resp; })\n      .catch(function(error) { c.clear(); });\n    }\n  };\n}\n\nlet sdk = metricFactory('sdk.getTreatment', fibonacciCollector);\n\nfunction publish() {\n  sdk.publish();\n}\n\nmodule.exports = {\n  sdk,\n  publish\n};\n"]}