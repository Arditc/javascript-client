{"version":3,"sources":["../../es6/ds/splitChanges.js"],"names":[],"mappings":"WAAY;;AAEZ,QAAQ,kBAAR;;AAEA,IAAI,MAAM,QAAQ,OAAR,EAAiB,oBAAjB,CAAN;AACJ,IAAI,MAAM,QAAQ,QAAR,CAAN;AACJ,IAAI,sBAAsB,QAAQ,0BAAR,CAAtB;AACJ,IAAI,aAAa,CAAC,CAAD;;AAEjB,SAAS,sBAAT,OAAoD;MAAnB,yCAAmB;;AAClD,SAAO,MAAM,6BAA2B,UAA3B,CAAN,EAAgD;AACrD,YAAQ,KAAR;AACA,aAAS;AACP,gBAAU,kBAAV;AACA,sBAAgB,kBAAhB;AACA,mCAA2B,gBAA3B;KAHF;GAFK,EAQN,IARM,CAQD;WAAQ,KAAK,IAAL;GAAR,CARC,CASN,IATM,CASD,gBAAQ;QACP,OAAgB,KAAhB,KADO;QACD,SAAU,KAAV,OADC;;AAGZ,cAAQ,6DAAwD,UAAhE,EAA8E,IAA9E,EAHY;;AAKZ,iBAAa,IAAb,CALY;;AAOZ,WAAO,oBAAqB,MAArB,CAAP,CAPY;GAAR,CATC,CAkBN,KAlBM,CAkBA,iBAAS;AACd,cAAQ,+DAA0D,wBAAmB,WAArF,EADc;;AAGd,WAAO,KAAP,CAHc;GAAT,CAlBP,CADkD;CAApD;;AA0BA,OAAO,OAAP,GAAiB,sBAAjB","file":"splitChanges.js","sourcesContent":["/* @flow */ 'use strict';\n\nrequire('isomorphic-fetch');\n\nlet log = require('debug')('splitio-cache:http');\nlet url = require('../url');\nlet splitMutatorFactory = require('../mutators/splitChanges');\nlet sinceValue = -1;\n\nfunction splitChangesDataSource({authorizationKey}) {\n  return fetch(url(`/splitChanges?since=${sinceValue}`), {\n    method: 'GET',\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${authorizationKey}`\n    }\n  })\n  .then(resp => resp.json())\n  .then(json => {\n    let {till, splits} = json;\n\n    log(`[${authorizationKey}] /splitChanges response using since=${sinceValue}`, json);\n\n    sinceValue = till;\n\n    return splitMutatorFactory( splits );\n  })\n  .catch(error => {\n    log(`[${authorizationKey}] failure fetching splits using since [${sinceValue}] => [${error}]`);\n\n    return error;\n  });\n}\n\nmodule.exports = splitChangesDataSource;\n"]}