{"version":3,"sources":["../es6/node.js"],"names":[],"mappings":"WAAY;;;;AAEZ,IAAI,2BAA2B,QAAQ,qBAAR,CAA3B;AACJ,IAAI,yBAAyB,QAAQ,mBAAR,CAAzB;AACJ,IAAI,UAAU,QAAQ,WAAR,CAAV;AACJ,IAAI,MAAM,QAAQ,OAAR,EAAiB,eAAjB,CAAN;;AAEJ,SAAS,MAAT,CAAgB,gBAAhB,EAAkC;AAChC,YAAQ,uCAAR,EADgC;;AAGhC,SAAO,uBAAuB,EAAC,kCAAD,EAAvB,EACJ,IADI,CACC;WAAiB,cAAc,QAAQ,MAAR,CAAe,MAAf;GAA/B,CADD,CAEJ,IAFI,CAEC;WAAY,QAAQ,GAAR,CAChB,6BAAI,UAAJ,CAAc,GAAd,CAAkB;aAAe,yBAAyB,EAAC,kCAAD,EAAmB,wBAAnB,EAAzB;KAAf,CADF;GAAZ,CAFD,CAKJ,IALI,CAKC,4BAAoB;AACxB,qBAAiB,OAAjB,CAA0B;aAAW,QAAQ,QAAQ,QAAR,CAAiB,GAAjB,EAAsB,QAAQ,QAAR,CAAiB,MAAjB;KAAzC,CAA1B,CADwB;GAApB,CALD,CAQJ,IARI,CAQE;WAAM;GAAN,CART,CAHgC;CAAlC;;AAeA,OAAO,OAAP,GAAiB,MAAjB","file":"node.js","sourcesContent":["/* @flow */ 'use strict';\n\nlet segmentChangesDataSource = require('./ds/segmentChanges');\nlet splitChangesDataSource = require('./ds/splitChanges');\nlet storage = require('./storage');\nlet log = require('debug')('splitio-cache');\n\nfunction writer(authorizationKey) {\n  log(`[${authorizationKey}] Running updater.`);\n\n  return splitChangesDataSource({authorizationKey})\n    .then(splitsMutator => splitsMutator(storage.splits.update))\n    .then(segments => Promise.all(\n      [...segments].map(segmentName => segmentChangesDataSource({authorizationKey, segmentName}))\n    ))\n    .then(segmentsMutators => {\n      segmentsMutators.forEach( mutator => mutator(storage.segments.get, storage.segments.update) );\n    })\n    .then( () => storage );\n\n}\n\nmodule.exports = writer;\n"]}