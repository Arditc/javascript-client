{"version":3,"sources":["../es6/node.js"],"names":[],"mappings":"WAAY,YAAY,CAAC;;;;AAEzB,IAAI,wBAAwB,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC9D,IAAI,sBAAsB,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAC1D,IAAI,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AACnC,IAAI,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,eAAe,CAAC,CAAC;;AAE5C,SAAS,MAAM,CAAC,gBAAgB,EAAE;AAChC,KAAG,OAAK,gBAAgB,wBAAqB,CAAC;;AAE9C,SAAO,sBAAsB,CAAC,EAAC,gBAAgB,EAAhB,gBAAgB,EAAC,CAAC,CAC9C,IAAI,CAAC,UAAA,aAAa;WAAI,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC;GAAA,CAAC,CAC3D,IAAI,CAAC,UAAA,QAAQ;WAAI,OAAO,CAAC,GAAG,CAC3B,6BAAI,QAAQ,GAAE,GAAG,CAAC,UAAA,WAAW;aAAI,wBAAwB,CAAC,EAAC,gBAAgB,EAAhB,gBAAgB,EAAE,WAAW,EAAX,WAAW,EAAC,CAAC;KAAA,CAAC,CAC5F;GAAA,CAAC,CACD,IAAI,CAAC,UAAA,gBAAgB,EAAI;AACxB,oBAAgB,CAAC,OAAO,CAAE,UAAA,OAAO;aAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;KAAA,CAAE,CAAC;GAC/F,CAAC,CACD,IAAI,CAAE;WAAM,OAAO;GAAA,CAAE,CAAC;CAE1B;;AAED,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC","file":"node.js","sourcesContent":["/* @flow */ 'use strict';\n\nlet segmentChangesDataSource = require('./ds/segmentChanges');\nlet splitChangesDataSource = require('./ds/splitChanges');\nlet storage = require('./storage');\nlet log = require('debug')('splitio-cache');\n\nfunction writer(authorizationKey) {\n  log(`[${authorizationKey}] Running updater.`);\n\n  return splitChangesDataSource({authorizationKey})\n    .then(splitsMutator => splitsMutator(storage.splits.update))\n    .then(segments => Promise.all(\n      [...segments].map(segmentName => segmentChangesDataSource({authorizationKey, segmentName}))\n    ))\n    .then(segmentsMutators => {\n      segmentsMutators.forEach( mutator => mutator(storage.segments.get, storage.segments.update) );\n    })\n    .then( () => storage );\n\n}\n\nmodule.exports = writer;\n"]}